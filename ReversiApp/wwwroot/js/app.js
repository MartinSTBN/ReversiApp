"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var string=window.location.pathname,split=string.split("/"),id=split[3],apiUrl=window.location.origin+"/api/spel/state/"+id;console.log("@Model.Speler.Kleur");var Game=function(){var r,e={apiUrl:apiUrl},t={gameState:0},a=function(){var e=window.location.origin+"/api/spel/join/"+id;Game.Model.lookingForPlayer(e).then(function(e){var n=JSON.parse(e);if(null!=n){var t=window.location.origin+"/api/spel/spelers/"+id;Game.Data.get(t).then(function(e){if(null==JSON.parse(e)[1]){var t=Game.parseTemplate("feedbacksuccess",{name:n});$("#success").html(t);var a=new FeedbackWidget("feedback-success");a.show(e,"success"),window.clearInterval(r),$(".btn--weigeren").click(function(){a.hide(),window.setTimeout(i,2e3)}),$(".btn--akkoord").click(function(){var e=window.location.origin+"/api/spel/joinstatus/"+id;Game.Data.post(e,{status:"Akkoord"}),a.hide()})}else window.clearInterval(r)})}})},i=function(){window.clearInterval(r),r=window.setInterval(a,1e3)};return{init:function(e){this.API.init(),this.Reversi.init(),this.Data.init(e),this.Model.init(),this.Stats.init(),r=window.setInterval(a,1e3)},currentGameState:function(){Game.Model.getGameState(e.apiUrl).then(function(e){t.gameState=e,console.log(t.gameState)})},placeFiche:function(e,t){this.Reversi.placeFiche(e,t)},setTitle:function(e){this.Reversi.setTitle(e)},getTemplate:function(e){return this.Template.getTemplate(e)},parseTemplate:function(e,t){return this.Template.parseTemplate(e,t)},processData:function(){Game.Reversi.processData()},createBoard:function(){return Game.Reversi.createBoard()},doeZet:function(e,t){return Game.API.doeZet(e,t)},updateBoard:function(e,t,a){Game.Reversi.updateBoard(e,t,a)},getSpelers:function(){return Game.Stats.getSpelers().then(function(e){return e})},getPlayState:function(){return Game.Model.getPlayState().then(function(e){return e})}}}(),FeedbackWidget=function(){function t(e){_classCallCheck(this,t),this._elementId=e}return _createClass(t,[{key:"show",value:function(e,t){var a=document.getElementById(this._elementId),n="#"+this._elementId;"none"===a.style.display&&($(n).fadeIn(),a.style.display="block"),"success"==t&&($(n).removeClass("alert-danger"),$(n).addClass("alert-success")),"danger"==t&&($(n).removeClass("alert-success"),$(n).addClass("alert-danger"),$(n).text(e));var r={message:e,type:t};this.log(r)}},{key:"hide",value:function(){$("#"+this._elementId).fadeOut(),document.getElementById("speelBord").style.pointerEvents="auto"}},{key:"log",value:function(e){var t=localStorage.getItem("feedback_widget");null!=t?t.split(",").length<10?((t=t?JSON.parse(t):{})[e.type]=e.message,localStorage.setItem("feedback_widget",JSON.stringify(t))):console.log("feedback_widget storage limit reached"):((t=t?JSON.parse(t):{})[e.type]=e.message,localStorage.setItem("feedback_widget",JSON.stringify(t)))}},{key:"removeLog",value:function(e){localStorage.removeItem(e)}},{key:"history",value:function(){var e="",t=JSON.parse(localStorage.getItem("feedback_widget"));for(var a in t)e=e+"<type |"+a+"|>  -  <"+t[a]+">\n\n";return console.log(e),e}},{key:"elementId",get:function(){return this._elementId}}]),t}();Game.API={init:function(){},getRandomCatPic:function(e){return Game.Data.get(e)},doeZet:function(e,t){var a=window.location.origin+"/api/spel/doezet/"+id+"/"+e+"/"+t;return Game.Data.get(a).then(function(e){if(JSON.parse(e))return e;var t=new FeedbackWidget("feedback-danger");return t.show("Zet niet mogelijk!","danger"),setTimeout(function(){t.hide()},1e3),e})}},Game.Data=function(){var e={url:apiUrl,mock:[{url:apiUrl,data:0}]},t={environment:"production"},a=function(){var a=e.mock;return new Promise(function(e,t){e(a)})};return{init:function(e){t.environment=e},get:function(e){if("production"==t.environment)return $.get(e).then(function(e){return e}).catch(function(e){console.log(e.message)});if("development"==t.environment)return a(e);throw new Error('Environment moet de waarde "production" of "development" hebben.')},post:function(e,t){$.post(e,t)}}}(),Game.Model={init:function(){},getWeather:function(e){return Game.Data.get(e).then(function(e){if(e.main.temp)throw new Error("Geen temperatuur ontvangen.");console.log(e)}).catch(function(e){console.log("Error opgevangen, error bericht: ".concat(e.message))})},getGameState:function(e){var t=Game.Data.get(e);if(t.data<=0||2<t.data)throw new Error("Waarde "+t.data+" valt buiten de geldige waarde!");return t},lookingForPlayer:function(e){return Game.Data.get(e).then(function(e){return e})},getPlayState:function(e){return Game.Data.get(e).then(function(e){return e})}},Game.Reversi=function(){function s(e,t){var a=document.createElement("div");"Wit"==t&&(a.className="fiche-wit"),"Zwart"==t&&(a.className="fiche-zwart"),document.getElementById(e).appendChild(a)}var c,d,e={apiUrl:apiUrl,catUrl:"https://api.thecatapi.com/v1/images/search"},l={responsive:!1,legend:{labels:{boxWidth:0}},scales:{yAxes:[{stacked:!0,gridLines:{display:!0,color:"rgba(255,99,132,0.2)"}}],xAxes:[{ticks:{min:0,max:80},gridLines:{display:!1}}]}};return{init:function(){},placeFiche:s,setTitle:function(e){document.getElementById("AanDeBeurt").textContent="Player "+e+" is aan de beurt"},processData:function(){Game.API.getRandomCatPic(e.catUrl).then(function(e){return Game.parseTemplate("catpic",{url:e[0].url})}).then(function(e){$("#catPic").html(e)})},createBoard:function(){return Game.Model.getGameState(e.apiUrl).then(function(e){return e}).then(function(e){var t=JSON.parse(e),a=Game.parseTemplate("speelbord",{array:t});$("#speelBord").html(a)}).then(function(){Game.Stats.aantalVeldBezet().then(function(e){var t=JSON.parse(e),a=t[0],n=t[1],r=t[2];0!=a&&0!=n&&0!=r||(r<n?alert("Zwart heeft gewonnen met "+n+" tegen "+r):n<r?alert("Wit heeft gewonnen met "+r+" tegen "+n):alert("Gelijkspel!"));var i=document.getElementById("aantalBezet");c=new Chart(i,{type:"horizontalBar",options:l,data:{labels:["Geen","Zwart","Wit"],datasets:[{label:"Aantal bezette velden per kleur",barThickness:50,data:[t[0],t[1],t[2]],backgroundColor:["rgba(0, 128, 0, 0.7)","rgba(0, 0, 0, 0.7)","rgba(200, 200, 200, 0.7)"]}]}});var o=document.getElementById("aantalVeroverd");d=new Chart(o,{type:"horizontalBar",options:l,data:{labels:["Zwart","Wit"],datasets:[{label:"Aantal veroverd per speler",barThickness:50,data:[0,0],backgroundColor:["rgba(0, 0, 0, 0.7)","rgba(200, 200, 200, 0.7)"]}]}})}).then(function(){Game.Stats.aantalGeslagen().then(function(e){var t=JSON.parse(e);d.data.datasets[0].data[1]=t[0],d.data.datasets[0].data[0]=t[1],d.update()})})})},updateBoard:function(e,t,a){s(a,t);for(var n=JSON.parse(e),r=0;r<n.length;r++){for(var i=n[r].split(","),o=i[0]+i[1],l=document.getElementById(o);l.hasChildNodes();)l.removeChild(l.firstChild);Game.placeFiche(o,t)}Game.Stats.aantalVeldBezet().then(function(e){var t=JSON.parse(e);console.log(t[0]+" result 0"),c.data.datasets[0].data[0]=t[0],c.data.datasets[0].data[1]=t[1],c.data.datasets[0].data[2]=t[2],c.update();var a=t[0],n=t[1],r=t[2];0!=a&&0!=n&&0!=r||(r<n?alert("Zwart heeft gewonnen met "+n+" tegen "+r):n<r?alert("Wit heeft gewonnen met "+r+" tegen "+n):alert("Gelijkspel!"))}),Game.Stats.aantalGeslagen().then(function(e){var t=JSON.parse(e);d.data.datasets[0].data[1]=t[0],d.data.datasets[0].data[0]=t[1],d.update()})}}}(),Game.Stats={init:function(){},aantalVeldBezet:function(){var e=window.location.origin+"/api/spel/aantalbezet/"+id;return Game.Data.get(e).then(function(e){return e})},aantalGeslagen:function(){var e=window.location.origin+"/api/spel/aantalgeslagen/"+id;return Game.Data.get(e).then(function(e){return e})},getSpelers:function(){var e=window.location.origin+"/api/spel/spelers/"+id;return Game.Data.get(e).then(function(e){return e})}},Game.Template={getTemplate:function(e){return spa_templates.templates[e]},parseTemplate:function(e,t){return spa_templates.templates[e].body(t)}};